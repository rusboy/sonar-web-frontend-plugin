
    <!-- Note: No pull requests accepted for this file. See README.md in the root directory for details. -->

<h1 id="disallow-control-flow-statements-in-finally-blocks-no-unsafe-finally">disallow control flow statements in <code class="highlighter-rouge">finally</code> blocks (no-unsafe-finally)</h1>

<p>JavaScript suspends the control flow statements of <code class="highlighter-rouge">try</code> and <code class="highlighter-rouge">catch</code> blocks until the execution of <code class="highlighter-rouge">finally</code> block finishes. So, when <code class="highlighter-rouge">return</code>, <code class="highlighter-rouge">throw</code>, <code class="highlighter-rouge">break</code>, or <code class="highlighter-rouge">continue</code> is used in <code class="highlighter-rouge">finally</code>, control flow statements inside <code class="highlighter-rouge">try</code> and <code class="highlighter-rouge">catch</code> are overwritten, which is considered as unexpected behavior. Such as:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// We expect this function to return 1;</span><br/><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span><br/>    <span class="k">try</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// 1 is returned but suspended until finally block ends</span><br/>    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span><br/>    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// 3 is returned before 1, which we did not expect</span><br/>    <span class="p">}</span><br/><span class="p">})();</span><br/><br/><span class="c1">// &gt; 3</span><br/></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// We expect this function to throw an error, then return</span><br/><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span><br/>    <span class="k">try</span> <span class="p">{</span><br/>        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">"Try"</span><span class="p">);</span> <span class="c1">// error is thrown but suspended until finally block ends</span><br/>    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// 3 is returned before the error is thrown, which we did not expect</span><br/>    <span class="p">}</span><br/><span class="p">})();</span><br/><br/><span class="c1">// &gt; 3</span><br/></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// We expect this function to throw Try(...) error from the catch block</span><br/><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span><br/>    <span class="k">try</span> <span class="p">{</span><br/>        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">"Try"</span><span class="p">)</span><br/>    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span><br/>        <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span> <span class="c1">// The error thrown from try block is catched and rethrown</span><br/>    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span><br/>        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">"Finally"</span><span class="p">);</span> <span class="c1">// Finally(...) is thrown, which we did not expect</span><br/>    <span class="p">}</span><br/><span class="p">})();</span><br/><br/><span class="c1">// &gt; Uncaught Error: Finally(...)</span><br/></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// We expect this function to return 0 from try block.</span><br/><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span><br/>  <span class="na">label</span><span class="p">:</span> <span class="k">try</span> <span class="p">{</span><br/>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 1 is returned but suspended until finally block ends</span><br/>  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span><br/>    <span class="k">break</span> <span class="nx">label</span><span class="p">;</span> <span class="c1">// It breaks out the try-finally block, before 0 is returned.</span><br/>  <span class="p">}</span><br/>  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span><br/><span class="p">})();</span><br/><br/><span class="c1">// &gt; 1</span><br/></code></pre>
</div>

<h2 id="rule-details">Rule Details<a style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; padding-left: 0.375em;" class="anchorjs-link " href="#rule-details" aria-label="Anchor link for: rule details" data-anchorjs-icon="î§‹"></a></h2>

<p>This rule disallows <code class="highlighter-rouge">return</code>, <code class="highlighter-rouge">throw</code>, <code class="highlighter-rouge">break</code>, and <code class="highlighter-rouge">continue</code> statements inside <code class="highlighter-rouge">finally</code> blocks. It allows indirect usages, such as in <code class="highlighter-rouge">function</code> or <code class="highlighter-rouge">class</code> definitions.</p>

<p class="incorrect icon">Examples of <strong>incorrect</strong> code for this rule:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/*eslint no-unsafe-finally: "error"*/</span><br/><span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><br/>    <span class="k">try</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span><br/>    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span><br/>    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">3</span><span class="p">;</span><br/>    <span class="p">}</span><br/><span class="p">};</span><br/></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/*eslint no-unsafe-finally: "error"*/</span><br/><span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><br/>    <span class="k">try</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span><br/>    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span><br/>    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span><br/>        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">;</span><br/>    <span class="p">}</span><br/><span class="p">};</span><br/></code></pre>
</div>

<p class="correct icon">Examples of <strong>correct</strong> code for this rule:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/*eslint no-unsafe-finally: "error"*/</span><br/><span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><br/>    <span class="k">try</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span><br/>    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span><br/>    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span><br/>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"hola!"</span><span class="p">);</span><br/>    <span class="p">}</span><br/><span class="p">};</span><br/></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/*eslint no-unsafe-finally: "error"*/</span><br/><span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><br/>    <span class="k">try</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span><br/>    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span><br/>    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span><br/>        <span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><br/>            <span class="k">return</span> <span class="s2">"hola!"</span><span class="p">;</span><br/>        <span class="p">}</span><br/>    <span class="p">}</span><br/><span class="p">};</span><br/></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/*eslint no-unsafe-finally: "error"*/</span><br/><span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span><br/>    <span class="k">try</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span><br/>    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span><br/>        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span><br/>    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span><br/>        <span class="k">switch</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span><br/>            <span class="k">case</span> <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><br/>                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"hola!"</span><span class="p">)</span><br/>                <span class="k">break</span><span class="p">;</span><br/>            <span class="p">}</span><br/>        <span class="p">}</span><br/>    <span class="p">}</span><br/><span class="p">};</span><br/></code></pre>
</div>

<h2 id="when-not-to-use-it">When Not To Use It<a style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; padding-left: 0.375em;" class="anchorjs-link " href="#when-not-to-use-it" aria-label="Anchor link for: when not to use it" data-anchorjs-icon="î§‹"></a></h2>

<p>If you want to allow control flow operations in <code class="highlighter-rouge">finally</code> blocks, you can turn this rule off.</p>

<h2 id="version">Version<a style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; padding-left: 0.375em;" class="anchorjs-link " href="#version" aria-label="Anchor link for: version" data-anchorjs-icon="î§‹"></a></h2>

<p>This rule was introduced in ESLint 2.9.0.</p>

<h2 id="resources">Resources<a style="font-family: anchorjs-icons; font-style: normal; font-variant: normal; font-weight: normal; padding-left: 0.375em;" class="anchorjs-link " href="#resources" aria-label="Anchor link for: resources" data-anchorjs-icon="î§‹"></a></h2>

<ul>
  <li><a href="https://github.com/eslint/eslint/tree/master/lib/rules/no-unsafe-finally.js">Rule source</a></li>
  <li><a href="https://github.com/eslint/eslint/tree/master/docs/rules/no-unsafe-finally.md">Documentation source</a></li>
</ul>

  